<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Template</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <link rel="stylesheet" href="css/main.css" />
    <link
      rel="shortcut icon"
      href="/web/assets/images/favicon.png"
      type="image/x-icon"
    />
  </head>
  <body class="container" onload="init()">
    <!--=oncontextmenu="return false" onselectstart="return false" ondragstart="return false">-->

    <section class="header-container">
      <div class="search-container">
        <input type="search" name="" id="" placeholder="Search anything" />
      </div>
      <span class="user-preview"></span>
    </section>
    <section class="logo">
      <h1>logo</h1>
    </section>
    <section class="file-list-container">
      <button onclick="onBack()" class="back-btn" disabled="true">back</button>
      <span class="breadcrumbs"></span>
      <ul class="file-list"></ul>
    </section>
    <section class="dashboard">
      <h4 class="total-size"></h4>
    </section>
    <section class="folder-details">
      <h4>Folder details</h4>
      <div class="file-content"></div>
    </section>
    <section class="upload-file"></section>
    <section class="history"></section>
    <section class="terminal"></section>
    <section class="send-mail"></section>

    <dialog>
      <h1>Modal</h1>
      <button>click</button>
    </dialog>

    <script type="text/javascript" src="/eel.js"></script>

    <script>
     
    
      system = [
        "Linux ubuntoserver 5.15.0-94-generic #104-Ubuntu SMP Tue Jan 9 15:25:40 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux",
      ];
      user = ["tal0311"];

      async function init() {
        await eel.init_app()();
        // renderFileList(files);
        js_inner_html(".user-preview", user[0]);
      }

      function renderFileList(files) {
        strHtml = files
          .map((file, idx) => {
            item = file.split(" ");
            if (idx !== 0) {
              return `<li class="file-item" onclick="onItemClick('${
                item[0]
              }', '${item.at(-1)}')">${item.at(-1)}</li>`;
            }
          })
          .join("");

        js_inner_html(".file-list", strHtml);
        js_inner_html(".total-size", files[0]);
      }

      eel.expose(js_inner_html);
      function js_inner_html(selector, html) {
        document.querySelector(selector).innerHTML = html;
      }

      eel.expose(showModal);
      function showModal() {
        document.querySelector("dialog").showModal();
      }

      eel.expose(closeModal);
      function closeModal() {
        document.querySelector("dialog").close();
      }

      eel.expose(js_alert);
      function js_alert(message) {
        alert(message);
      }

      async function onItemClick(permissions, itemName) {
        console.log("item clicked", itemName);
        permissions.includes("d")
          ? await eel.get_folder_details(itemName)()
          : await eel.get_file_details(itemName)();
      }

      eel.expose(js_render_folder_details);
      function js_render_folder_details(folderDetails ,curr_dir='/home/tal0311/') {
        document.querySelector(".back-btn").disabled = curr_dir === '/home/tal0311/'? true : false;
         renderFileList(folderDetails);
        // renderBreadcrumbs(dir)
      }

      function renderBreadcrumbs() {
        eel.get_breadcrumbs(dir)
        js_inner_html(".breadcrumbs", "Home");
      }
      eel.expose(js_render_file_details);
      function js_render_file_details(fileDetails) {
        
        html = `<code><pre>${fileDetails}</pre></code>`
        js_inner_html(".file-content", html);
      }

      function onBack() {
        eel.get_back()();
      }

     

    </script>
  </body>
</html>
